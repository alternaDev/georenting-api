#%RAML 0.8

title: GeoRenting
baseUri: https://georenting.herokuapp.com/{version}
version: v1

schemas:
  - Fence: !include schema/fence.json

securitySchemes:
  - x-jean-auth:
      type: x-Jean-Auth
      description: Some requests require authentication.
      describedBy:
        headers:
          Authorization:
            description: |
              Used to send a valid Jean-Auth Token.
            type: string
        responses:
          401:
            description: |
              Bad or expired token. Reauthenticate the user.
          403:
            description: |
              Things are going bad for you. Reauthenticating won't help here.

/users:
  get:
   queryParameters:
     name:
       description: filter the users by name
/fences:
  get:
    description: Get Fences.
    queryParameters:
      user:
        description: Get all Fences owned by the specified User ID.
      latitude:
        description: Get Fences near the specified center location. Requires longitude and radius.
      longitude:
        description: Get Fences near the specified center location. Requires latitude and radius.
      radius:
        description: Get Fences near the specified center location. Requires latitude and longitude.
    responses:
      200:
        body:
          application/json:
            schema: Fence
            example: |
              [
                {
                  "id": 42
                  "centerLon": 54.42,
                  "centerLat": 8.5,
                  "name": "Ulfs Castle"
                },
                {
                  "id": 45
                  "centerLon": 51.42,
                  "centerLat": 4.5,
                  "name": "Pedas House"
                }
              ]
  post:
    description: Create the GeoFence.
    securedBy: [x-jean-auth]
    body:
      application/json:
        schema: Fence
        example: |
          {
            "centerLon": 54.42,
            "centerLat": 8.5,
            "name": "Ulfs Castle"
          }
    responses:
      200:
        body:
          application/json:
            schema: Fence
            example: |
              {
                "id": "42",
                "centerLon": 54.42,
                "centerLat": 8.5,
                "name": "Ulfs Castle"
              }
      402:
        description: The user does not have enough GeoCoins.
      400:
        description: The GeoFence is overlapping with another GeoFence in its radius.
  /{fenceId}:
    get:
      description: Get information about the GeoFence.
      responses:
        200:
          body:
            application/json:
              schema: Fence
              example: |
                {
                  "id": "42",
                  "centerLon": 54.42,
                  "centerLat": 8.5,
                  "name": "Ulfs Castle"
                }
        404:
          description: Not found.
    put:
      description: Update the GeoFence. Requires the user to be the owner of it.
      securedBy: [x-jean-auth]
      responses:
        200:
          body:
            application/json:
              schema: Fence
              example: |
                {
                  "id": "42",
                  "centerLon": 54.42,
                  "centerLat": 8.5,
                  "name": "Ulfs Castle"
                }
        404:
          description: Not Found.
        403:
          description: The current user is not authorized to update that fence.
      body:
        application/json:
          schema: Fence
          example: |
            {
              "id": "42",
              "centerLon": 54.42,
              "centerLat": 8.5,
              "name": "Ulfs Castle"
            }

    /visit:
      post:
        securedBy: [x-jean-auth]
        description: |
          This method will visit a GeoFence. The visitor and the owner will be notified
          via GCM.
